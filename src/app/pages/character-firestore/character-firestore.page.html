<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>Characters</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding">
  <ion-segment [value]="mode" (ionChange)="onModeChange($event)" class="ion-margin-bottom">
    <ion-segment-button value="all">
      <ion-label>Todos</ion-label>
    </ion-segment-button>
    <ion-segment-button value="aliveMales">
      <ion-label>Alive • Male</ion-label>
    </ion-segment-button>
  </ion-segment>

  <ion-list *ngIf="characters$ | async as items; else loading">
    <ion-item *ngFor="let ch of items" lines="inset" class="character-item">
      <ion-avatar slot="start">
        <img *ngIf="ch.image; else noimg" [src]="ch.image" alt="{{ch.name}}" />
        <ng-template #noimg>
          <img src="https://via.placeholder.com/80x80.png?text=?" alt="no image" />
        </ng-template>
      </ion-avatar>

      <ion-label>
        <h2>{{ ch.name }}</h2>
        <div class="chips">
          <ion-chip *ngIf="ch.status">{{ ch.status }}</ion-chip>
          <ion-chip *ngIf="ch.gender">{{ ch.gender }}</ion-chip>
          <ion-chip *ngIf="ch.species">{{ ch.species }}</ion-chip>
        </div>

        <ng-container *ngIf="toDate(ch.created) as d">
          <p class="created">Creado: {{ d | date:'medium' }}</p>
        </ng-container>
      </ion-label>
    </ion-item>

    <ion-item *ngIf="items.length === 0">
      <ion-label><ion-text>No hay documentos en la colección.</ion-text></ion-label>
    </ion-item>
  </ion-list>

  <ng-template #loading>
    <ion-text>Cargando personajes…</ion-text>
  </ng-template>
</ion-content>
