<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>Characters CRUD (Firestore)</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding">

  <form [formGroup]="createForm" (ngSubmit)="createOne()">
    <ion-list>
      <ion-item>
        <ion-label position="stacked">Nombre</ion-label>
        <ion-input formControlName="name" placeholder="Ej: Rick Sanchez"></ion-input>
      </ion-item>

      <ion-grid>
        <ion-row>
          <ion-col size="6">
            <ion-item>
              <ion-label position="stacked">Género</ion-label>
              <ion-select formControlName="gender">
                <ion-select-option value="Male">Male</ion-select-option>
                <ion-select-option value="Female">Female</ion-select-option>
                <ion-select-option value="Unknown">Unknown</ion-select-option>
              </ion-select>
            </ion-item>
          </ion-col>

          <ion-col size="6">
            <ion-item>
              <ion-label position="stacked">Estado</ion-label>
              <ion-select formControlName="status">
                <ion-select-option value="Alive">Alive</ion-select-option>
                <ion-select-option value="Dead">Dead</ion-select-option>
                <ion-select-option value="Unknown">Unknown</ion-select-option>
              </ion-select>
            </ion-item>
          </ion-col>
        </ion-row>
      </ion-grid>

      <ion-item>
        <ion-label position="stacked">Especie</ion-label>
        <ion-input formControlName="species" placeholder="Human"></ion-input>
      </ion-item>

      <ion-item>
        <ion-label position="stacked">Imagen (URL)</ion-label>
        <ion-input formControlName="image" placeholder="https://..."></ion-input>
      </ion-item>

      <ion-button class="ion-margin-top" expand="block" type="submit" [disabled]="createForm.invalid">
        Crear
      </ion-button>
    </ion-list>
  </form>

  <ion-button class="ion-margin-top" expand="block" fill="outline" (click)="seed3()">
    Crear 3 de prueba
  </ion-button>

  <hr class="ion-margin-vertical" />

  <!-- LISTADO -->
  <ion-list *ngIf="characters$ | async as items; else loading">
    <ion-item-sliding *ngFor="let ch of items">
      <ion-item>
        <ion-avatar slot="start">
          <img *ngIf="ch.image; else noimg" [src]="ch.image" alt="{{ch.name}}" />
          <ng-template #noimg>
            <img src="https://via.placeholder.com/64x64.png?text=?" alt="no image" />
          </ng-template>
        </ion-avatar>
        <ion-label>
          <h2>{{ ch.name }}</h2>
          <p>ID (num): {{ ch.id }} • DocID: {{ ch.firestoreId }}</p>
          <p>{{ ch.gender }} • {{ ch.status }} • {{ ch.species || '—' }}</p>
          <ng-container *ngIf="toDate(ch.created) as d">
            <p>Creado: {{ d | date:'medium' }}</p>
          </ng-container>
        </ion-label>
      </ion-item>

      <ion-item-options side="end">
        <ion-item-option color="primary" (click)="startEdit(ch)">Editar</ion-item-option>
        <ion-item-option color="danger" (click)="remove(ch)">Eliminar</ion-item-option>
      </ion-item-options>
    </ion-item-sliding>
  </ion-list>

  <ng-template #loading>
    <ion-text>Cargando...</ion-text>
  </ng-template>

  <!-- EDITAR -->
  <form *ngIf="editingId as eid" [formGroup]="editForm" (ngSubmit)="saveEdit()" class="edit-panel ion-margin-top">
    <h3>Editar</h3>

    <ion-item>
      <ion-label position="stacked">Nombre</ion-label>
      <ion-input formControlName="name"></ion-input>
    </ion-item>

    <ion-grid>
      <ion-row>
        <ion-col size="6">
          <ion-item>
            <ion-label position="stacked">Género</ion-label>
            <ion-select formControlName="gender">
              <ion-select-option value="Male">Male</ion-select-option>
              <ion-select-option value="Female">Female</ion-select-option>
              <ion-select-option value="Unknown">Unknown</ion-select-option>
            </ion-select>
          </ion-item>
        </ion-col>
        <ion-col size="6">
          <ion-item>
            <ion-label position="stacked">Estado</ion-label>
            <ion-select formControlName="status">
              <ion-select-option value="Alive">Alive</ion-select-option>
              <ion-select-option value="Dead">Dead</ion-select-option>
              <ion-select-option value="Unknown">Unknown</ion-select-option>
            </ion-select>
          </ion-item>
        </ion-col>
      </ion-row>
    </ion-grid>

    <ion-item>
      <ion-label position="stacked">Especie</ion-label>
      <ion-input formControlName="species"></ion-input>
    </ion-item>

    <ion-item>
      <ion-label position="stacked">Imagen (URL)</ion-label>
      <ion-input formControlName="image"></ion-input>
    </ion-item>

    <ion-button class="ion-margin-top" type="submit" [disabled]="editForm.invalid">Guardar</ion-button>
    <ion-button class="ion-margin-top" type="button" fill="outline" (click)="cancelEdit()">Cancelar</ion-button>
  </form>

</ion-content>
